# apparmor.d - Full set of apparmor profiles
# Copyright (C) 2017 Canonical Ltd
# Copyright (C) 2023-2025 Alexandre Pujol <alexandre@pujol.io>
# SPDX-License-Identifier: GPL-2.0-only

# Allow to display Status Notifier Items in the KDE Plasma systray (including supporting context menu)

  abi <abi/4.0>,

  dbus send bus=session path=/StatusNotifierWatcher
       interface=org.freedesktop.DBus.Properties
       member=Get
       peer=(name=org.kde.StatusNotifierWatcher, label="@{pp_app_indicator}"),

  dbus send bus=session path=/StatusNotifierItem
       interface=org.freedesktop.DBus.Properties
       member=GetAll
       peer=(name=@{busname}, label="@{pp_app_indicator}"),

  dbus receive bus=session path=/StatusNotifierWatcher
       interface=org.freedesktop.DBus.Properties
       member=Get
       peer=(name=@{busname}, label="@{pp_app_indicator}"),

  dbus send bus=session path=/StatusNotifierWatcher
       interface=org.kde.StatusNotifierWatcher
       member=RegisterStatusNotifierItem
       peer=(name="{@{busname},org.kde.StatusNotifierWatcher}", label="@{pp_app_indicator}"),

  dbus receive bus=session path=/StatusNotifierWatcher
       interface=org.kde.StatusNotifierWatcher
       member=RegisterStatusNotifierItem
       peer=(name=@{busname}, label="@{pp_app_indicator}"),

  dbus send bus=session path=/StatusNotifierItem
       interface=org.kde.StatusNotifierItem
       member={ProvideXdgActivationToken,Activate}
       peer=(name=@{busname}, label="@{pp_app_indicator}"),

  dbus send bus=session path=/MenuBar
       interface=com.canonical.dbusmenu
       member={AboutToShow,GetLayout,Event}
       peer=(name=@{busname}, label="@{pp_app_indicator}"),

  include if exists <abstractions/bus/session/org.kde.StatusNotifierWatcher.d>

# vim:syntax=apparmor
