# apparmor.d - Full set of apparmor profiles
# Copyright (C) 2024 Alexandre Pujol <alexandre@pujol.io>
# SPDX-License-Identifier: GPL-2.0-only
# LOGPROF-SUGGEST: no

# Base set of rules for glycin-loaders without bwrap (no glycin sandbox).
# - It is safe to use including by a profile stacking glycin

# See https://github.com/roddhjav/apparmor.d/issues/903 for more details.

  abi <abi/4.0>,

  include <abstractions/fonts>

  unix type=stream peer=(label=glycin),
  unix type=stream peer=(label=glycin//loaders),

  signal (send receive) set=kill peer=@{profile_name},
  signal (send receive) set=kill peer=@{profile_name}//&glycin,
  signal (send receive) set=kill peer=glycin,

  ptrace read peer=@{profile_name},
  ptrace read peer=@{profile_name}//&glycin,
  ptrace read peer=glycin,

  ## still required here to avoid crashed, but without execute permissions
  @{bin}/bwrap mr,

  /usr/share/glycin-loaders/{,**} r,

  /usr/share/gtksourceview-2.0/{,**} r,
  /usr/share/gtksourceview-3.0/{,**} r,
  /usr/share/gtksourceview-4/{,**} r,
  /usr/share/gtksourceview-5/{,**} r,

  owner @{tmp}/gdk-pixbuf-glycin-tmp.@{rand6} rw,

  ## deny userns, # do not use! This would block userns in stacked parent process as well

  include if exists <abstractions/app/glycin-fallback.d>

# vim:syntax=apparmor
